<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>TOEIC ワンクリック理解度記録</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    * {
      box-sizing: border-box;
    }
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #020617;
      color: #e5e7eb;
    }
    .app {
      height: 100vh;
      display: flex;
      flex-direction: column;
    }
    .header {
      padding: 10px 14px;
      background: #0f172a;
      border-bottom: 1px solid #1f2937;
      font-size: 0.9rem;
    }
    .row {
      display: flex;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
      margin-top: 4px;
    }
    .current-word {
      font-size: 1.1rem;
      font-weight: 600;
    }
    .badge {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 999px;
      background: #1f2937;
      font-size: 0.75rem;
    }
    .jump-input {
      width: 90px;
      padding: 6px 8px;
      border-radius: 999px;
      border: 1px solid #374151;
      background: #020617;
      color: #e5e7eb;
      font-size: 0.9rem;
    }
    .small-btn {
      padding: 6px 10px;
      border-radius: 999px;
      border: none;
      background: #334155;
      color: #e5e7eb;
      font-size: 0.85rem;
      cursor: pointer;
      touch-action: manipulation;
    }
    .small-btn:active {
      opacity: 0.8;
      transform: scale(0.97);
    }

    .counter-row {
      font-size: 0.8rem;
      opacity: 0.8;
      margin-top: 2px;
      display: flex;
      gap: 10px;
    }

    .button-area {
      flex: 1;
      display: flex;
      flex-direction: column;
    }
    .btn {
      flex: 1;
      border: none;
      width: 100%;
      font-size: 2.3rem;
      font-weight: 700;
      cursor: pointer;
      touch-action: manipulation;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 12px;
    }
    .btn-yes {
      background: #16a34a;
      color: #ecfdf5;
      border-bottom: 1px solid #0f172a;
    }
    .btn-no {
      background: #dc2626;
      color: #fef2f2;
    }
    .btn:active {
      opacity: 0.8;
      transform: scale(0.99);
    }

    .footer {
      padding: 4px 12px 8px;
      background: #020617;
      font-size: 0.75rem;
      opacity: 0.8;
    }
  </style>
</head>
<body>
  <div class="app">
    <!-- 上部の情報エリア -->
    <div class="header">
      <div class="current-word">
        現在：<span id="currentIndex">1</span> 単語目
        <span class="badge">番号だけ管理モード</span>
      </div>
      <div class="row">
        <span style="font-size:0.8rem;">移動先：</span>
        <input
          id="jumpInput"
          type="number"
          class="jump-input"
          min="1"
          inputmode="numeric"
        />
        <button class="small-btn" onclick="jumpToWord()">この番号へ移動</button>
        <button class="small-btn" onclick="step(-1)">← 1つ戻る</button>
        <button class="small-btn" onclick="step(1)">1つ進む →</button>
      </div>
      <div class="counter-row" id="stats">
        まだ回答履歴がありません
      </div>
    </div>

    <!-- 画面ほぼ全体を使う二択ボタン -->
    <div class="button-area">
      <button class="btn btn-yes" onclick="recordAnswer('known')">
        わかる
      </button>
      <button class="btn btn-no" onclick="recordAnswer('unknown')">
        わからない
      </button>
    </div>

    <div class="footer">
      ・紙の単語帳や別アプリの単語を見ながら、今の「単語番号」だけをここで記録します。<br />
      ・タップすると「記録＋番号+1」に自動で進みます（履歴はブラウザに保存）。
    </div>
  </div>

  <script>
    const STORAGE_STATE_KEY = "toeic_simple_state_v1";
    const STORAGE_LOGS_KEY  = "toeic_simple_logs_v1";

    let state = {
      currentIndex: 1   // 今何単語目か（1始まり）
    };

    /** ログ: { time, index, result } を配列で保持 */
    let logs = [];

    function loadFromStorage() {
      try {
        const s = localStorage.getItem(STORAGE_STATE_KEY);
        const l = localStorage.getItem(STORAGE_LOGS_KEY);
        if (s) state = JSON.parse(s);
        if (l) logs  = JSON.parse(l);
      } catch (e) {
        console.error("load error", e);
      }
    }

    function saveState() {
      localStorage.setItem(STORAGE_STATE_KEY, JSON.stringify(state));
    }

    function saveLogs() {
      localStorage.setItem(STORAGE_LOGS_KEY, JSON.stringify(logs));
    }

    function render() {
      document.getElementById("currentIndex").textContent = state.currentIndex;
      document.getElementById("jumpInput").value = "";
      updateStats();
    }

    function recordAnswer(result) {
      const nowIso = new Date().toISOString();
      logs.push({
        time: nowIso,
        index: state.currentIndex,
        result: result   // "known" or "unknown"
      });
      saveLogs();

      // 次の単語へ自動で進む
      state.currentIndex = Math.max(1, state.currentIndex + 1);
      saveState();
      render();
    }

    function jumpToWord() {
      const input = document.getElementById("jumpInput");
      const value = parseInt(input.value, 10);
      if (isNaN(value) || value < 1) {
        alert("1以上の数字を入力してください。");
        return;
      }
      state.currentIndex = value;
      saveState();
      render();
    }

    function step(delta) {
      const next = state.currentIndex + delta;
      state.currentIndex = Math.max(1, next);
      saveState();
      render();
    }

    function updateStats() {
      const statsEl = document.getElementById("stats");
      if (logs.length === 0) {
        statsEl.textContent = "まだ回答履歴がありません";
        return;
      }

      let known = 0;
      let unknown = 0;
      for (const log of logs) {
        if (log.result === "known") known++;
        else if (log.result === "unknown") unknown++;
      }

      const total = logs.length;
      const knownRate = Math.round((known / total) * 100);

      statsEl.innerHTML =
        `合計回答数: ${total}件　` +
        `「わかる」: ${known}件 (${knownRate}%)　` +
        `「わからない」: ${unknown}件`;
    }

    // 初期ロード
    loadFromStorage();
    render();
  </script>
</body>
</html>
